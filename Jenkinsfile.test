pipeline{
    agent any
    stages{
        stage('install client'){
            dir('client'){
                steps{
                    sh 'npm install'
                }
            }
        }
        
        stage('test client'){
            dir('client'){
                steps{
                    sh 'npm test'
                }
            }
        }

        stage('install server'){
            dir('server'){
                steps{
                    sh 'npm install'
                }
            }
        }

        stage('test server'){
            dir('server'){
                steps{
                    sh 'npm test'
                }
            }
        }
    }

    post{
        success{
            script{
                //set commit status to success
                echo 'test passed.'
                githubCommitStatus(
                    context: 'ESLINT-banners',
                    state: 'SUCCESS',
                    message: 'Build and test passed',
                )
            }
        }
        failure{
            script{
                echo 'test failed.'
                githubCommitStatus(
                    context: 'ESLINT-banners',
                    state: 'FAILURE',
                    message: 'Build and test failed',
                )
            }
        }
    }

    triggers{
        githubPush()
    }
}